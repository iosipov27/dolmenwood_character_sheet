{"version":3,"file":"buildAbilities.js","sourceRoot":"","sources":["../../src/utils/buildAbilities.ts"],"names":[],"mappings":"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","sourcesContent":["import { ABILITIES } from \"../constants/abilities.js\";\nimport { formatSigned } from \"./formatSigned.js\";\nimport type { DwAbilityView } from \"../types.js\";\n\nexport function buildAbilities(systemData: Record<string, unknown>): DwAbilityView[] {\n    const candidates: Array<(k: string) => string> = [\n        (k: string) => `system.abilities.${k}.value`,\n        (k: string) => `system.abilities.${k}`,\n        (k: string) => `system.stats.${k}.value`,\n        (k: string) => `system.stats.${k}`,\n        (k: string) => `system.attributes.${k}.value`,\n        (k: string) => `system.attributes.${k}`,\n        (k: string) => `system.scores.${k}.value`,\n        (k: string) => `system.scores.${k}`,\n        (k: string) => `system.abilities.${k.toUpperCase()}.value`,\n        (k: string) => `system.stats.${k.toUpperCase()}.value`\n    ];\n\n    const modCandidates: Array<(base: string) => string> = [\n        (base: string) => base.replace(/\\.value$/, \".mod\"),\n        (base: string) => base.replace(/\\.value$/, \".modifier\"),\n        (base: string) => base.replace(/\\.value$/, \".bonus\"),\n        (base: string) => base.replace(/\\.value$/, \".bns\")\n    ];\n\n    const wrapper: { system: Record<string, unknown> } = { system: systemData };\n    const out: DwAbilityView[] = [];\n\n    for (const a of ABILITIES) {\n        let foundPath: string | null = null;\n        let value = 0;\n\n        for (const mk of candidates) {\n            const p = mk(a.key);\n            const v = foundry.utils.getProperty(wrapper, p);\n            if (typeof v === \"number\") {\n                foundPath = p;\n                value = v;\n                break;\n            }\n        }\n\n        let mod = 0;\n        let hasMod = false;\n        if (foundPath && String(foundPath).endsWith(\".value\")) {\n            for (const mm of modCandidates) {\n                const mp = mm(foundPath);\n                const mv = foundry.utils.getProperty(wrapper, mp);\n                if (typeof mv === \"number\") {\n                    mod = mv;\n                    hasMod = true;\n                    break;\n                }\n            }\n        }\n\n        out.push({\n            key: a.key,\n            label: a.label,\n            value,\n            name: foundPath ?? \"\",\n            hasPath: Boolean(foundPath),\n            mod,\n            hasMod,\n            modText: hasMod ? formatSigned(mod) : \"\"\n        });\n    }\n\n    return out;\n}\n"]}