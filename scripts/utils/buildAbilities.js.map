{"version":3,"file":"buildAbilities.js","sourceRoot":"","sources":["../../src/utils/buildAbilities.ts"],"names":[],"mappings":"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","sourcesContent":["import { ABILITIES } from \"../constants/abilities.js\";\r\nimport { formatSigned } from \"./formatSigned.js\";\r\nimport type { DwAbilityView } from \"../types.js\";\r\n\r\nexport function buildAbilities(systemData: Record<string, unknown>): DwAbilityView[] {\r\n  const candidates: Array<(k: string) => string> = [\r\n    (k: string) => `system.abilities.${k}.value`,\r\n    (k: string) => `system.abilities.${k}`,\r\n    (k: string) => `system.stats.${k}.value`,\r\n    (k: string) => `system.stats.${k}`,\r\n    (k: string) => `system.attributes.${k}.value`,\r\n    (k: string) => `system.attributes.${k}`,\r\n    (k: string) => `system.scores.${k}.value`,\r\n    (k: string) => `system.scores.${k}`,\r\n    (k: string) => `system.abilities.${k.toUpperCase()}.value`,\r\n    (k: string) => `system.stats.${k.toUpperCase()}.value`\r\n  ];\r\n\r\n  const modCandidates: Array<(base: string) => string> = [\r\n    (base: string) => base.replace(/\\.value$/, \".mod\"),\r\n    (base: string) => base.replace(/\\.value$/, \".modifier\"),\r\n    (base: string) => base.replace(/\\.value$/, \".bonus\"),\r\n    (base: string) => base.replace(/\\.value$/, \".bns\")\r\n  ];\r\n\r\n  const wrapper: { system: Record<string, unknown> } = { system: systemData };\r\n  const out: DwAbilityView[] = [];\r\n\r\n  for (const a of ABILITIES) {\r\n    let foundPath: string | null = null;\r\n    let value = 0;\r\n\r\n    for (const mk of candidates) {\r\n      const p = mk(a.key);\r\n      const v = foundry.utils.getProperty(wrapper, p);\r\n\r\n      if (typeof v === \"number\") {\r\n        foundPath = p;\r\n        value = v;\r\n        break;\r\n      }\r\n    }\r\n\r\n    let mod = 0;\r\n    let hasMod = false;\r\n\r\n    if (foundPath && String(foundPath).endsWith(\".value\")) {\r\n      for (const mm of modCandidates) {\r\n        const mp = mm(foundPath);\r\n        const mv = foundry.utils.getProperty(wrapper, mp);\r\n\r\n        if (typeof mv === \"number\") {\r\n          mod = mv;\r\n          hasMod = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    out.push({\r\n      key: a.key,\r\n      label: a.label,\r\n      value,\r\n      name: foundPath ?? \"\",\r\n      hasPath: Boolean(foundPath),\r\n      mod,\r\n      hasMod,\r\n      modText: hasMod ? formatSigned(mod) : \"\"\r\n    });\r\n  }\r\n\r\n  return out;\r\n}\r\n"]}